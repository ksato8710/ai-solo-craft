# ãƒ‹ãƒ¥ãƒ¼ã‚¹ãƒ¬ã‚¿ãƒ¼æ©Ÿèƒ½ æŠ€è¡“ä»•æ§˜

*ä½œæˆæ—¥: 2026-02-19*

> ãƒªãƒ¼ãƒ³ã‚­ãƒ£ãƒ³ãƒã‚¹ Phase 2 ã®ã€Œãƒ¡ãƒ¼ãƒ«ãƒ‹ãƒ¥ãƒ¼ã‚¹ãƒ¬ã‚¿ãƒ¼ã€æ©Ÿèƒ½ã€‚æ¯æœã® Digest ã‚’ãƒ¡ãƒ¼ãƒ«ã§å±Šã‘ã‚‹ã‚·ãƒ³ãƒ—ãƒ«ãªã‚µãƒ¼ãƒ“ã‚¹ã¨ã—ã¦ã‚¹ã‚¿ãƒ¼ãƒˆã—ã€å°†æ¥ã®æœ‰æ–™åŒ–ã¸ã®å¸ƒçŸ³ã¨ã™ã‚‹ã€‚

---

## 1. ã‚¢ãƒ¼ã‚­ãƒ†ã‚¯ãƒãƒ£æ¦‚è¦

```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚                     ãƒ¦ãƒ¼ã‚¶ãƒ¼                          â”‚
â”‚                                                      â”‚
â”‚  â‘  ç™»éŒ²ãƒ•ã‚©ãƒ¼ãƒ    â‘¡ ç¢ºèªãƒ¡ãƒ¼ãƒ«   â‘¢ æœåˆŠãƒ¡ãƒ¼ãƒ«        â”‚
â”‚     (Web UI)        (Resend)       (Resend)          â”‚
â””â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
       â”‚              â”‚              â”‚
       â–¼              â–¼              â–¼
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚                  Next.js API Routes                   â”‚
â”‚                                                      â”‚
â”‚  POST /api/newsletter/subscribe   â† ç™»éŒ²             â”‚
â”‚  GET  /api/newsletter/confirm     â† ç¢ºèª             â”‚
â”‚  GET  /api/newsletter/unsubscribe â† é…ä¿¡åœæ­¢          â”‚
â”‚  POST /api/cron/send-newsletter   â† æ—¥æ¬¡é…ä¿¡          â”‚
â””â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
       â”‚              â”‚              â”‚
       â–¼              â–¼              â–¼
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â” â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â” â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â” â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚   Supabase   â”‚ â”‚  Resend  â”‚ â”‚ Vercel Cron  â”‚ â”‚   Slack   â”‚
â”‚ (PostgreSQL) â”‚ â”‚ (Email)  â”‚ â”‚  (23:15 UTC) â”‚ â”‚  (é€šçŸ¥)   â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜ â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜ â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜ â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

---

## 2. æŠ€è¡“é¸å®š

| è¦ç´  | æŠ€è¡“ | ç†ç”± |
|------|------|------|
| ãƒ¡ãƒ¼ãƒ«é…ä¿¡ | **Resend** | React Email ãƒã‚¤ãƒ†ã‚£ãƒ–å¯¾å¿œã€Next.js è¦ªå’Œæ€§ã€ç„¡æ–™æ  3,000é€š/æœˆ |
| é‹ç”¨é€šçŸ¥ | **Slack API** | ç™»éŒ²/ç¢ºèªã‚¤ãƒ™ãƒ³ãƒˆã‚’ãƒªã‚¢ãƒ«ã‚¿ã‚¤ãƒ é€šçŸ¥ã€æ—¢å­˜ Bot Token æµç”¨ |
| ãƒ†ãƒ³ãƒ—ãƒ¬ãƒ¼ãƒˆ | **React Email** | JSX ã§ãƒ¡ãƒ¼ãƒ« HTML ç”Ÿæˆã€ãƒ—ãƒ­ã‚¸ã‚§ã‚¯ãƒˆã® TSX ãƒ‘ã‚¿ãƒ¼ãƒ³ã¨çµ±ä¸€ |
| ã‚¹ã‚±ã‚¸ãƒ¥ãƒ¼ãƒ© | **Vercel Cron Jobs** | `vercel.json` ã«1è¡Œè¿½åŠ ã§å®Œçµã€Hobby ãƒ—ãƒ©ãƒ³å¯¾å¿œ |
| ãƒ‡ãƒ¼ã‚¿ä¿å­˜ | **Supabase** | æ—¢å­˜ã‚¤ãƒ³ãƒ•ãƒ©æµç”¨ã€RLS ã§ã‚»ã‚­ãƒ¥ãƒªãƒ†ã‚£æ‹…ä¿ |
| Opt-in | **ã‚·ãƒ³ã‚°ãƒ«ã‚ªãƒ—ãƒˆã‚¤ãƒ³ + ç¢ºèªãƒ¡ãƒ¼ãƒ«** | ç™»éŒ² â†’ pending â†’ ç¢ºèªãƒªãƒ³ã‚¯ â†’ active |

---

## 3. ãƒ‡ãƒ¼ã‚¿ãƒ¢ãƒ‡ãƒ«

### 3.1 newsletter_subscribers

ãƒã‚¤ã‚°ãƒ¬ãƒ¼ã‚·ãƒ§ãƒ³: `supabase/migrations/20260219000000_add_newsletter.sql`

| ã‚«ãƒ©ãƒ  | å‹ | èª¬æ˜ |
|--------|-----|------|
| `id` | uuid PK | `gen_random_uuid()` |
| `email` | text UNIQUE | CHECK åˆ¶ç´„ã§ãƒ•ã‚©ãƒ¼ãƒãƒƒãƒˆæ¤œè¨¼ |
| `status` | `subscriber_status` enum | `pending_verification` / `active` / `unsubscribed` / `bounced` / `complained` |
| `verify_token` | uuid UNIQUE | ç¢ºèªç”¨ãƒˆãƒ¼ã‚¯ãƒ³ï¼ˆè‡ªå‹•ç”Ÿæˆï¼‰ |
| `verified_at` | timestamptz | ç¢ºèªå®Œäº†æ—¥æ™‚ |
| `unsubscribe_token` | uuid UNIQUE | é…ä¿¡åœæ­¢ç”¨ãƒˆãƒ¼ã‚¯ãƒ³ï¼ˆå…¨ãƒ¡ãƒ¼ãƒ«ã«åŸ‹ã‚è¾¼ã¿ï¼‰ |
| `unsubscribed_at` | timestamptz | é…ä¿¡åœæ­¢æ—¥æ™‚ |
| `unsubscribe_reason` | text | ãƒ•ã‚£ãƒ¼ãƒ‰ãƒãƒƒã‚¯ç†ç”± |
| `ip_address` | text | ç™»éŒ²æ™‚ IPï¼ˆãƒ¬ãƒ¼ãƒˆåˆ¶é™ç”¨ï¼‰ |
| `user_agent` | text | ç™»éŒ²æ™‚ UA |
| `tier` | text DEFAULT `'free'` | å°†æ¥ã®æœ‰æ–™åŒ–å¯¾å¿œ |
| `preferences` | jsonb DEFAULT `'{}'` | å°†æ¥ã®é…ä¿¡è¨­å®šå¯¾å¿œ |
| `created_at` / `updated_at` | timestamptz | `set_updated_at()` ãƒˆãƒªã‚¬ãƒ¼åˆ©ç”¨ |

### 3.2 newsletter_send_logs

| ã‚«ãƒ©ãƒ  | å‹ | èª¬æ˜ |
|--------|-----|------|
| `id` | uuid PK | |
| `digest_content_id` | uuid FK â†’ `contents` | é…ä¿¡ã—ãŸ Digest |
| `subject` | text | ãƒ¡ãƒ¼ãƒ«ä»¶å |
| `send_date` | date | é…ä¿¡æ—¥ |
| `total_recipients` | integer | å¯¾è±¡è€…æ•° |
| `successful_sends` | integer | æˆåŠŸæ•° |
| `failed_sends` | integer | å¤±æ•—æ•° |
| `errors` | jsonb | ã‚¨ãƒ©ãƒ¼è©³ç´° |
| `started_at` / `completed_at` | timestamptz | é…ä¿¡æ™‚é–“ |

### 3.3 RLS

ä¸¡ãƒ†ãƒ¼ãƒ–ãƒ«ã¨ã‚‚ RLS æœ‰åŠ¹ã€‚ãƒãƒªã‚·ãƒ¼ãªã— = `anon` / `authenticated` ã‚¢ã‚¯ã‚»ã‚¹ä¸å¯ã€‚`service_role` ã®ã¿æ“ä½œå¯èƒ½ã€‚

### 3.4 ã‚¹ãƒ†ãƒ¼ã‚¿ã‚¹é·ç§»

```
[æ–°è¦ç™»éŒ²] â†’ pending_verification â†’ [ç¢ºèªã‚¯ãƒªãƒƒã‚¯] â†’ active â†’ [é…ä¿¡åœæ­¢] â†’ unsubscribed
                                                      â†“
                                                  bounced / complainedï¼ˆResend Webhook ã§å°†æ¥å¯¾å¿œï¼‰
```

---

## 4. API ã‚¨ãƒ³ãƒ‰ãƒã‚¤ãƒ³ãƒˆ

### 4.1 `POST /api/newsletter/subscribe`

ç™»éŒ²å‡¦ç†ã€‚

| é …ç›® | å†…å®¹ |
|------|------|
| ãƒªã‚¯ã‚¨ã‚¹ãƒˆ | `{ email: string, _hp?: string }` |
| ãƒ¬ã‚¹ãƒãƒ³ã‚¹ | `{ ok: boolean, message: string }` |
| ã‚»ã‚­ãƒ¥ãƒªãƒ†ã‚£ | ãƒãƒ‹ãƒ¼ãƒãƒƒãƒˆ (`_hp`)ã€ãƒ¬ãƒ¼ãƒˆåˆ¶é™ï¼ˆåŒä¸€ IP ã‹ã‚‰ 1h ã« 5å›ï¼‰ã€ãƒ¡ãƒ¼ãƒ«å½¢å¼æ¤œè¨¼ |
| å‰¯ä½œç”¨ | DB upsert + Resend ç¢ºèªãƒ¡ãƒ¼ãƒ«é€ä¿¡ + Slack é€šçŸ¥ |

**å‡¦ç†ãƒ•ãƒ­ãƒ¼:**
1. ãƒãƒ‹ãƒ¼ãƒãƒƒãƒˆãƒã‚§ãƒƒã‚¯ï¼ˆ`_hp` ãŒç©ºã§ãªã‘ã‚Œã°ãƒœãƒƒãƒˆï¼‰
2. ãƒ¡ãƒ¼ãƒ«å½¢å¼ãƒãƒªãƒ‡ãƒ¼ã‚·ãƒ§ãƒ³
3. IP ãƒ™ãƒ¼ã‚¹ãƒ¬ãƒ¼ãƒˆåˆ¶é™ãƒã‚§ãƒƒã‚¯
4. DB æ—¢å­˜ãƒã‚§ãƒƒã‚¯ â†’ æ–°è¦ insert / æ—¢å­˜æ›´æ–°ï¼ˆå†é€å¯¾å¿œï¼‰
5. ç¢ºèªãƒ¡ãƒ¼ãƒ«é€ä¿¡ï¼ˆResendï¼‰
6. Slack é€šçŸ¥ï¼ˆ`ğŸ“¬ ãƒ‹ãƒ¥ãƒ¼ã‚¹ãƒ¬ã‚¿ãƒ¼æ–°è¦ç™»éŒ²: {email}`ã€fire-and-forgetï¼‰

### 4.2 `GET /api/newsletter/confirm?token=xxx`

ç¢ºèªå‡¦ç†ã€‚

| é …ç›® | å†…å®¹ |
|------|------|
| ãƒ‘ãƒ©ãƒ¡ãƒ¼ã‚¿ | `token` (verify_token) |
| å‡¦ç† | `status` â†’ `active`ã€`verified_at` è¨˜éŒ²ã€Slack é€šçŸ¥ |
| ãƒªãƒ€ã‚¤ãƒ¬ã‚¯ãƒˆ | `/newsletter/confirmed?status=success` or `?status=error` |

### 4.3 `GET /api/newsletter/unsubscribe?token=xxx`

é…ä¿¡åœæ­¢å‡¦ç†ã€‚

| é …ç›® | å†…å®¹ |
|------|------|
| ãƒ‘ãƒ©ãƒ¡ãƒ¼ã‚¿ | `token` (unsubscribe_token) |
| å‡¦ç† | `status` â†’ `unsubscribed`ã€`unsubscribed_at` è¨˜éŒ² |
| ãƒªãƒ€ã‚¤ãƒ¬ã‚¯ãƒˆ | `/newsletter/unsubscribed?status=success&token=xxx` or `?status=error` |

### 4.4 `POST /api/cron/send-newsletter`

æ—¥æ¬¡é…ä¿¡ï¼ˆVercel Cron ã‹ã‚‰å‘¼ã³å‡ºã—ï¼‰ã€‚

| é …ç›® | å†…å®¹ |
|------|------|
| èªè¨¼ | `Authorization: Bearer {CRON_SECRET}` |
| ã‚¹ã‚±ã‚¸ãƒ¥ãƒ¼ãƒ« | `15 23 * * *` UTC = JST 8:15 |
| å‡¦ç† | æœ€æ–° morning digest å–å¾— â†’ active è³¼èª­è€…ã«ãƒãƒƒãƒé€ä¿¡ï¼ˆ50é€š/ãƒãƒƒãƒï¼‰ |
| ãƒ˜ãƒƒãƒ€ãƒ¼ | `List-Unsubscribe` / `List-Unsubscribe-Post` ä»˜ä¸ |
| ãƒ­ã‚° | `newsletter_send_logs` ã«è¨˜éŒ² |
| ãƒ†ã‚¹ãƒˆå†é€ | `?force=1` ã§åŒæ—¥é€ä¿¡æ¸ˆã¿ãƒã‚§ãƒƒã‚¯ã‚’ãƒã‚¤ãƒ‘ã‚¹ï¼ˆ`CRON_SECRET` å¿…é ˆï¼‰ |

**å‡¦ç†ãƒ•ãƒ­ãƒ¼:**
1. CRON_SECRET èªè¨¼
2. å½“æ—¥é€ä¿¡æ¸ˆã¿ãƒã‚§ãƒƒã‚¯ï¼ˆäºŒé‡é€ä¿¡é˜²æ­¢ï¼‰
3. æœ€æ–° morning digest + NVA ãƒ©ãƒ³ã‚­ãƒ³ã‚°å–å¾—
4. active è³¼èª­è€…ãƒªã‚¹ãƒˆå–å¾—
5. send_log ä½œæˆ
6. 50é€šãšã¤ `Promise.allSettled` ã§ãƒãƒƒãƒé€ä¿¡
7. send_log æ›´æ–°ï¼ˆæˆåŠŸ/å¤±æ•—æ•°ï¼‰

**è£œè¶³ï¼ˆæ¤œè¨¼é‹ç”¨ï¼‰**
- QA/æ¤œè¨¼æ™‚ã®ã¿ `POST /api/cron/send-newsletter?force=1` ã‚’ä½¿ç”¨å¯èƒ½ã€‚
- `force` ã¯åŒæ—¥é‡è¤‡é€ä¿¡ã‚’è¨±å¯ã™ã‚‹ãŸã‚ã€æœ¬ç•ªå®šæ™‚ã‚¸ãƒ§ãƒ–ã§ã¯ä½¿ç”¨ã—ãªã„ã€‚

---

## 5. ãƒ¡ãƒ¼ãƒ«ãƒ†ãƒ³ãƒ—ãƒ¬ãƒ¼ãƒˆ

React Email (`@react-email/components`) ã§å®Ÿè£…ã€‚

### 5.1 ç¢ºèªãƒ¡ãƒ¼ãƒ« (`src/emails/verification.tsx`)

```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚   AI Solo Builder (ãƒ­ã‚´)     â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚                             â”‚
â”‚  ãƒ‹ãƒ¥ãƒ¼ã‚¹ãƒ¬ã‚¿ãƒ¼ç™»éŒ²ã®ç¢ºèª     â”‚
â”‚                             â”‚
â”‚  ã”ç™»éŒ²ã‚ã‚ŠãŒã¨ã†ã”ã–ã„ã¾ã™ã€‚  â”‚
â”‚  ä»¥ä¸‹ã®ãƒœã‚¿ãƒ³ã§ç¢ºèªã‚’...      â”‚
â”‚                             â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”  â”‚
â”‚  â”‚   ç™»éŒ²ã‚’ç¢ºèªã™ã‚‹       â”‚  â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜  â”‚
â”‚                             â”‚
â”‚  å¿ƒå½“ãŸã‚ŠãŒãªã„å ´åˆã¯ç„¡è¦–...   â”‚
â”‚                             â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚  AI Solo Builder Â©          â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

### 5.2 æœåˆŠ Digest ãƒ¡ãƒ¼ãƒ« (`src/emails/morning-digest.tsx`)

```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚   AI Solo Builder (ãƒ­ã‚´)     â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚  2026-02-19                  â”‚
â”‚  æœåˆŠã‚¿ã‚¤ãƒˆãƒ«                â”‚
â”‚  ã‚µãƒãƒªãƒ¼...                 â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚  â–¶ Top 3 ãƒ˜ãƒƒãƒ‰ãƒ©ã‚¤ãƒ³       â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”    â”‚
â”‚  â”‚ 1 ãƒ˜ãƒƒãƒ‰ãƒ©ã‚¤ãƒ³1      â”‚    â”‚
â”‚  â”‚   NVA: 85/100       â”‚    â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜    â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”    â”‚
â”‚  â”‚ 2 ãƒ˜ãƒƒãƒ‰ãƒ©ã‚¤ãƒ³2      â”‚    â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜    â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”    â”‚
â”‚  â”‚ 3 ãƒ˜ãƒƒãƒ‰ãƒ©ã‚¤ãƒ³3      â”‚    â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜    â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚  â–¶ NVA ãƒ©ãƒ³ã‚­ãƒ³ã‚° 4-10      â”‚
â”‚  #4 ãƒ˜ãƒƒãƒ‰ãƒ©ã‚¤ãƒ³4 (72pt)     â”‚
â”‚  #5 ãƒ˜ãƒƒãƒ‰ãƒ©ã‚¤ãƒ³5 (68pt)     â”‚
â”‚  ...                        â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”  â”‚
â”‚  â”‚ ã‚µã‚¤ãƒˆã§å…¨æ–‡ã‚’èª­ã‚€     â”‚  â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜  â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚  é…ä¿¡åœæ­¢ã¯ã“ã¡ã‚‰            â”‚
â”‚  AI Solo Builder Â©          â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

### 5.3 å…±æœ‰ã‚³ãƒ³ãƒãƒ¼ãƒãƒ³ãƒˆ

| ãƒ•ã‚¡ã‚¤ãƒ« | å†…å®¹ |
|---------|------|
| `src/emails/components/email-header.tsx` | ãƒ­ã‚´ï¼ˆã‚°ãƒ©ãƒ‡ãƒ¼ã‚·ãƒ§ãƒ³ãƒ†ã‚­ã‚¹ãƒˆï¼‰ |
| `src/emails/components/email-footer.tsx` | é…ä¿¡åœæ­¢ãƒªãƒ³ã‚¯ + ã‚³ãƒ”ãƒ¼ãƒ©ã‚¤ãƒˆ |

### 5.4 ãƒ‡ã‚¶ã‚¤ãƒ³ä»•æ§˜

- èƒŒæ™¯è‰²: `#0f172a`ï¼ˆã‚µã‚¤ãƒˆã® dark navy ã¨çµ±ä¸€ï¼‰
- ãƒ•ã‚©ãƒ³ãƒˆ: Inter, Noto Sans JP
- CTA ãƒœã‚¿ãƒ³: `linear-gradient(to right, #3B82F6, #8B5CF6)`
- Top3 ãƒ©ãƒ³ã‚¯ãƒãƒƒã‚¸: é‡‘/éŠ€/éŠ…ã‚°ãƒ©ãƒ‡ãƒ¼ã‚·ãƒ§ãƒ³

---

## 6. ãƒ•ãƒ­ãƒ³ãƒˆã‚¨ãƒ³ãƒ‰

### 6.1 ã‚³ãƒ³ãƒãƒ¼ãƒãƒ³ãƒˆ

| ãƒ•ã‚¡ã‚¤ãƒ« | ç¨®åˆ¥ | å½¹å‰² |
|---------|------|------|
| `src/components/NewsletterButton.tsx` | client | ãƒ˜ãƒƒãƒ€ãƒ¼CTAï¼ˆãƒ‡ã‚¹ã‚¯ãƒˆãƒƒãƒ—: ãƒ†ã‚­ã‚¹ãƒˆ+ã‚¢ã‚¤ã‚³ãƒ³ / ãƒ¢ãƒã‚¤ãƒ«: ã‚¢ã‚¤ã‚³ãƒ³ã®ã¿ï¼‰ |
| `src/components/NewsletterModal.tsx` | client | ãƒ¢ãƒ¼ãƒ€ãƒ«ãƒ€ã‚¤ã‚¢ãƒ­ã‚°ï¼ˆãƒãƒ¼ã‚¿ãƒ«ã€ãƒ•ã‚©ãƒ¼ã‚«ã‚¹ãƒˆãƒ©ãƒƒãƒ—ã€Escapeé–‰ã˜ï¼‰ |
| `src/components/NewsletterForm.tsx` | client | å…±æœ‰ãƒ•ã‚©ãƒ¼ãƒ ï¼ˆmodal/inline/footer å¯¾å¿œã€å…¨çŠ¶æ…‹ç®¡ç†ï¼‰ |
| `src/components/NewsletterInlineSignup.tsx` | client | ãƒ›ãƒ¼ãƒ ãƒšãƒ¼ã‚¸ç”¨ã‚¤ãƒ³ãƒ©ã‚¤ãƒ³ CTA ã‚»ã‚¯ã‚·ãƒ§ãƒ³ |

### 6.2 ãƒšãƒ¼ã‚¸

| ãƒ‘ã‚¹ | ç¨®åˆ¥ | å½¹å‰² |
|------|------|------|
| `/newsletter/confirmed` | server | ç¢ºèªå®Œäº†ãƒšãƒ¼ã‚¸ï¼ˆæˆåŠŸ/ã‚¨ãƒ©ãƒ¼è¡¨ç¤ºï¼‰ |
| `/newsletter/unsubscribed` | client | é…ä¿¡åœæ­¢ãƒšãƒ¼ã‚¸ï¼ˆãƒ•ã‚£ãƒ¼ãƒ‰ãƒãƒƒã‚¯ãƒ•ã‚©ãƒ¼ãƒ ä»˜ãï¼‰ |

### 6.3 ãƒ‡ã‚¶ã‚¤ãƒ³

- **ãƒ¢ãƒ¼ãƒ€ãƒ«:** `z-[60]`, `bg-black/60 backdrop-blur-sm` ã‚ªãƒ¼ãƒãƒ¼ãƒ¬ã‚¤, `bg-[var(--bg-card)]` ã‚³ãƒ³ãƒ†ãƒŠ
- **CTA ãƒœã‚¿ãƒ³:** `bg-gradient-to-r from-blue-500 to-violet-500`ï¼ˆãƒ­ã‚´ã®ã‚°ãƒ©ãƒ‡ãƒ¼ã‚·ãƒ§ãƒ³ã¨çµ±ä¸€ï¼‰
- **ã‚¤ãƒ³ãƒ©ã‚¤ãƒ³ã‚»ã‚¯ã‚·ãƒ§ãƒ³:** `bg-gradient-to-br from-blue-500/10 via-violet-500/8 to-emerald-500/5`
- **ãƒãƒƒã‚¸:** ã€Œç„¡æ–™ã€ã€Œæ¯æœ 8:15 é…ä¿¡ã€ã€Œè§£é™¤ã¯ã„ã¤ã§ã‚‚ã€ã®3ã¤
- **æˆåŠŸçŠ¶æ…‹:** ãƒ•ã‚©ãƒ¼ãƒ ã‚’ checkmark + ãƒ¡ãƒƒã‚»ãƒ¼ã‚¸ã«å·®ã—æ›¿ãˆ
- **ã‚¢ãƒ‹ãƒ¡ãƒ¼ã‚·ãƒ§ãƒ³:** `globals.css` ã« `newsletter-overlay-in` / `newsletter-content-in` keyframes

### 6.4 æ—¢å­˜ãƒ•ã‚¡ã‚¤ãƒ«ã¸ã®çµ±åˆ

| ãƒ•ã‚¡ã‚¤ãƒ« | å¤‰æ›´å†…å®¹ |
|---------|---------|
| `src/app/layout.tsx` | ãƒ˜ãƒƒãƒ€ãƒ¼ Actions ã« `NewsletterButton` è¿½åŠ  |
| `src/app/page.tsx` | ãƒ‹ãƒ¥ãƒ¼ã‚¹ã¨ãƒ—ãƒ­ãƒ€ã‚¯ãƒˆã®é–“ã« `NewsletterInlineSignup` æŒ¿å…¥ |
| `src/app/globals.css` | ãƒ¢ãƒ¼ãƒ€ãƒ«ã‚¢ãƒ‹ãƒ¡ãƒ¼ã‚·ãƒ§ãƒ³ keyframes è¿½åŠ  |

---

## 7. Vercel Cron è¨­å®š

ãƒ•ã‚¡ã‚¤ãƒ«: `vercel.json`

```json
{
  "crons": [{
    "path": "/api/cron/send-newsletter",
    "schedule": "15 23 * * *"
  }]
}
```

- `15 23 * * *` UTC = JST 08:15
- Hobby ãƒ—ãƒ©ãƒ³: 1 cron/æ—¥ï¼ˆã“ã®ãƒ¦ãƒ¼ã‚¹ã‚±ãƒ¼ã‚¹ã«é©åˆï¼‰
- èªè¨¼: `CRON_SECRET` ãƒ˜ãƒƒãƒ€ãƒ¼ã§ Vercel ãŒè‡ªå‹•ä»˜ä¸

---

## 8. ç’°å¢ƒå¤‰æ•°

| å¤‰æ•° | ç”¨é€” | è¨­å®šå ´æ‰€ |
|------|------|---------|
| `RESEND_API_KEY` | Resend API ã‚­ãƒ¼ | `.env.local` + Vercel |
| `CRON_SECRET` | Vercel Cron èªè¨¼ã‚·ãƒ¼ã‚¯ãƒ¬ãƒƒãƒˆ | `.env.local` + Vercel |
| `NEXT_PUBLIC_SITE_URL` | ã‚µã‚¤ãƒˆURLï¼ˆãƒ¡ãƒ¼ãƒ«å†…ãƒªãƒ³ã‚¯ç”Ÿæˆï¼‰ | Vercelï¼ˆæœªè¨­å®šæ™‚ã¯ `https://ai.essential-navigator.com`ï¼‰ |
| `SLACK_BOT_TOKEN` | Slack Bot Tokenï¼ˆ`xoxb-...`ï¼‰| `.env.local` + Vercel |
| `SLACK_NOTIFICATION_CHANNEL` | é€šçŸ¥å…ˆ Slack ãƒãƒ£ãƒãƒ« ID | `.env.local` + Vercel |

---

## 9. Slack é€šçŸ¥

ç™»éŒ²ãƒ»ç¢ºèªã‚¤ãƒ™ãƒ³ãƒˆã‚’ãƒªã‚¢ãƒ«ã‚¿ã‚¤ãƒ ã§ Slack ãƒãƒ£ãƒãƒ«ã«é€šçŸ¥ã™ã‚‹ã€‚

### 9.1 é€šçŸ¥ã‚¿ã‚¤ãƒŸãƒ³ã‚°

| ã‚¤ãƒ™ãƒ³ãƒˆ | ãƒ¡ãƒƒã‚»ãƒ¼ã‚¸ | ãƒˆãƒªã‚¬ãƒ¼ |
|---------|-----------|---------|
| æ–°è¦ç™»éŒ² | `ğŸ“¬ ãƒ‹ãƒ¥ãƒ¼ã‚¹ãƒ¬ã‚¿ãƒ¼æ–°è¦ç™»éŒ²: {email}` | `/api/newsletter/subscribe`ï¼ˆæ—¢å­˜ active ã‚’é™¤ãï¼‰ |
| ç¢ºèªå®Œäº† | `âœ… ãƒ‹ãƒ¥ãƒ¼ã‚¹ãƒ¬ã‚¿ãƒ¼ç™»éŒ²ç¢ºèªå®Œäº†ï¼ˆãƒ¡ãƒ¼ãƒ«èªè¨¼æ¸ˆã¿ï¼‰` | `/api/newsletter/confirm`ï¼ˆæˆåŠŸæ™‚ï¼‰ |

### 9.2 å®Ÿè£…

- **é–¢æ•°:** `notifySlack(text)` in `src/lib/newsletter.ts`
- **API:** Slack `chat.postMessage`ï¼ˆ`fetch` ã§ç›´æ¥å‘¼ã³å‡ºã—ã€è¿½åŠ ä¾å­˜ãªã—ï¼‰
- **æ–¹å¼:** fire-and-forgetï¼ˆé€šçŸ¥å¤±æ•—ã¯ç™»éŒ²å‡¦ç†ã«å½±éŸ¿ã—ãªã„ï¼‰
- **ãƒãƒ£ãƒãƒ«:** `C0ACUDZCJJC`ï¼ˆç’°å¢ƒå¤‰æ•° `SLACK_NOTIFICATION_CHANNEL` ã§æŒ‡å®šï¼‰

---

## 10. ã‚»ã‚­ãƒ¥ãƒªãƒ†ã‚£

| å¯¾ç­– | å®Ÿè£… |
|------|------|
| ãƒœãƒƒãƒˆé˜²æ­¢ | ãƒãƒ‹ãƒ¼ãƒãƒƒãƒˆãƒ•ã‚£ãƒ¼ãƒ«ãƒ‰ (`_hp`) |
| ãƒ¬ãƒ¼ãƒˆåˆ¶é™ | åŒä¸€ IP ã‹ã‚‰ 1h ã« 5å›ã¾ã§ï¼ˆSupabase ã‚¯ã‚¨ãƒªï¼‰ |
| ãƒ¡ãƒ¼ãƒ«æ¤œè¨¼ | æ­£è¦è¡¨ç¾ + é•·ã•åˆ¶é™ï¼ˆ254æ–‡å­—ï¼‰ |
| Cron èªè¨¼ | `Authorization: Bearer {CRON_SECRET}` |
| RLS | `anon` / `authenticated` ã‚¢ã‚¯ã‚»ã‚¹ä¸å¯ã€`service_role` ã®ã¿ |
| List-Unsubscribe | RFC 8058 æº–æ‹ ãƒ˜ãƒƒãƒ€ãƒ¼ï¼ˆãƒ¯ãƒ³ã‚¯ãƒªãƒƒã‚¯é…ä¿¡åœæ­¢ï¼‰ |
| äºŒé‡é€ä¿¡é˜²æ­¢ | `send_date` ã§å½“æ—¥é€ä¿¡æ¸ˆã¿ãƒã‚§ãƒƒã‚¯ |

---

## 11. ã‚³ã‚¹ãƒˆè¦‹ç©ã‚‚ã‚Š

| è³¼èª­è€…æ•° | Resend | Vercel | Supabase | æœˆé¡åˆè¨ˆ |
|---------|--------|--------|----------|---------|
| ~100äºº | ç„¡æ–™ | ç„¡æ–™ | ç„¡æ–™ | **$0** |
| ~1,000äºº | $20 | ç„¡æ–™ | ç„¡æ–™ | **$20** |
| ~10,000äºº | $100 | $20 | ç„¡æ–™ | **$120** |

---

## 12. Resend ãƒ‰ãƒ¡ã‚¤ãƒ³èªè¨¼æ‰‹é †

1. Resend API ã§ãƒ‰ãƒ¡ã‚¤ãƒ³è¿½åŠ : `POST https://api.resend.com/domains` ï¼ˆFull Access ã‚­ãƒ¼ãŒå¿…è¦ï¼‰
2. è¿”å´ã•ã‚Œã‚‹ DNS ãƒ¬ã‚³ãƒ¼ãƒ‰ï¼ˆDKIM: TXT, SPF: MX + TXTï¼‰ã‚’ Route 53 ãƒ›ã‚¹ãƒˆã‚¾ãƒ¼ãƒ³ã«è¿½åŠ 
3. `POST https://api.resend.com/domains/{id}/verify` ã§æ¤œè¨¼ãƒˆãƒªã‚¬ãƒ¼
4. èªè¨¼å®Œäº†å¾Œã€`from` ã‚¢ãƒ‰ãƒ¬ã‚¹ã¨ã—ã¦ `newsletter@ai.essential-navigator.com` ãŒä½¿ç”¨å¯èƒ½ã«

**DNS ç®¡ç†:**
- ãƒ›ã‚¹ãƒˆã‚¾ãƒ¼ãƒ³: `Z063638914X04N4ZLWPVT`ï¼ˆ`essential-navigator.com`ï¼‰
- NS: `ns-1447.awsdns-52.org`, `ns-22.awsdns-02.com`, `ns-831.awsdns-39.net`, `ns-1745.awsdns-26.co.uk`
- Resend ãƒ¬ã‚³ãƒ¼ãƒ‰: `resend._domainkey.ai.essential-navigator.com` (TXT/DKIM), `send.ai.essential-navigator.com` (MX + TXT/SPF)
- Vercel: `ai.essential-navigator.com` â†’ CNAME â†’ `3a7426ab097d534b.vercel-dns-017.com`

---

## 13. å°†æ¥æ‹¡å¼µ

| æ©Ÿèƒ½ | å®Ÿè£…æ–¹é‡ |
|------|---------|
| Resend Webhook | bounce/complaint ã‚’è‡ªå‹•æ¤œçŸ¥ã€`status` ã‚’ `bounced` / `complained` ã«æ›´æ–° |
| æœ‰æ–™ãƒ‹ãƒ¥ãƒ¼ã‚¹ãƒ¬ã‚¿ãƒ¼ | `tier` ã‚«ãƒ©ãƒ ã§ free/pro ã‚’åˆ†é›¢ã€Pro é™å®šã‚³ãƒ³ãƒ†ãƒ³ãƒ„é…ä¿¡ |
| é…ä¿¡è¨­å®š | `preferences` jsonb ã§æ›œæ—¥æŒ‡å®šãƒ»ã‚«ãƒ†ã‚´ãƒªãƒ•ã‚£ãƒ«ã‚¿ |
| å¤•åˆŠé…ä¿¡ | cron è¿½åŠ  + `evening-digest.tsx` ãƒ†ãƒ³ãƒ—ãƒ¬ãƒ¼ãƒˆä½œæˆ |
| é–‹å°/ã‚¯ãƒªãƒƒã‚¯è¿½è·¡ | Resend Analytics API é€£æº |
| A/B ãƒ†ã‚¹ãƒˆ | ä»¶åã®ãƒãƒªã‚¨ãƒ¼ã‚·ãƒ§ãƒ³ãƒ†ã‚¹ãƒˆ |

---

## 14. ãƒ•ã‚¡ã‚¤ãƒ«ä¸€è¦§

```
src/
â”œâ”€â”€ lib/newsletter.ts                       # å…±æœ‰ãƒ©ã‚¤ãƒ–ãƒ©ãƒªï¼ˆDBæ“ä½œãƒ»ãƒãƒªãƒ‡ãƒ¼ã‚·ãƒ§ãƒ³ï¼‰
â”œâ”€â”€ emails/
â”‚   â”œâ”€â”€ verification.tsx                    # ç¢ºèªãƒ¡ãƒ¼ãƒ«ãƒ†ãƒ³ãƒ—ãƒ¬ãƒ¼ãƒˆ
â”‚   â”œâ”€â”€ morning-digest.tsx                  # æœåˆŠ Digest ãƒ¡ãƒ¼ãƒ«ãƒ†ãƒ³ãƒ—ãƒ¬ãƒ¼ãƒˆ
â”‚   â””â”€â”€ components/
â”‚       â”œâ”€â”€ email-header.tsx                # å…±æœ‰ãƒ˜ãƒƒãƒ€ãƒ¼
â”‚       â””â”€â”€ email-footer.tsx                # å…±æœ‰ãƒ•ãƒƒã‚¿ãƒ¼
â”œâ”€â”€ components/
â”‚   â”œâ”€â”€ NewsletterButton.tsx                # ãƒ˜ãƒƒãƒ€ãƒ¼CTA
â”‚   â”œâ”€â”€ NewsletterModal.tsx                 # ãƒ¢ãƒ¼ãƒ€ãƒ«ãƒ€ã‚¤ã‚¢ãƒ­ã‚°
â”‚   â”œâ”€â”€ NewsletterForm.tsx                  # å…±æœ‰ãƒ•ã‚©ãƒ¼ãƒ 
â”‚   â””â”€â”€ NewsletterInlineSignup.tsx          # ã‚¤ãƒ³ãƒ©ã‚¤ãƒ³CTA
â”œâ”€â”€ app/
â”‚   â”œâ”€â”€ api/
â”‚   â”‚   â”œâ”€â”€ newsletter/
â”‚   â”‚   â”‚   â”œâ”€â”€ subscribe/route.ts          # ç™»éŒ²API
â”‚   â”‚   â”‚   â”œâ”€â”€ confirm/route.ts            # ç¢ºèªAPI
â”‚   â”‚   â”‚   â””â”€â”€ unsubscribe/route.ts        # é…ä¿¡åœæ­¢API
â”‚   â”‚   â””â”€â”€ cron/
â”‚   â”‚       â””â”€â”€ send-newsletter/route.ts    # æ—¥æ¬¡é…ä¿¡API
â”‚   â””â”€â”€ newsletter/
â”‚       â”œâ”€â”€ confirmed/page.tsx              # ç¢ºèªå®Œäº†ãƒšãƒ¼ã‚¸
â”‚       â””â”€â”€ unsubscribed/page.tsx           # é…ä¿¡åœæ­¢ãƒšãƒ¼ã‚¸
supabase/
â””â”€â”€ migrations/
    â””â”€â”€ 20260219000000_add_newsletter.sql   # DBãƒã‚¤ã‚°ãƒ¬ãƒ¼ã‚·ãƒ§ãƒ³
vercel.json                                 # Cronè¨­å®š
```

---

*ã“ã®ãƒ‰ã‚­ãƒ¥ãƒ¡ãƒ³ãƒˆã¯ CLAUDE.md ã®æŠ€è¡“ä»•æ§˜ãƒ»ARCHITECTURE.mdãƒ»API.mdãƒ»DATABASE.md ã¨æ•´åˆã€‚å¤‰æ›´æ™‚ã¯é–¢é€£ãƒ‰ã‚­ãƒ¥ãƒ¡ãƒ³ãƒˆã‚‚æ›´æ–°ã™ã‚‹ã“ã¨ã€‚*

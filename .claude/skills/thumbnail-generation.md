# Thumbnail Generation — サムネイル画像生成スキル

## 概要
記事ごとにブランド統一されたキャッチーなサムネイル画像（1200x630 PNG）を生成する。
記事の関連企業・プロダクトのブランドカラー・アイコン・ロゴ形状を活用し、SVGキャラクター付きのイラスト風デザインで作成する。

## デザイン方針

### 採用スタイル: "Illustrated Card"（The Neuron風）
- **レイアウト**: 左にテキスト、右にキャラクター/イラスト
- **キャラクター**: 記事の関連プロダクトのアイコン・ロゴをキャラクター化したSVGマスコット
- **テキスト**: 大きなセリフ体タイトル + カテゴリバッジ + ブランドラベル
- **背景**: 関連企業のブランドカラーを活用したグラデーションまたは単色
- **装飾**: ミニスパークル、コンフェッティ、ドットパターン

---

## ブランドアセットDB（自動拡張）

> **重要ルール**: このテーブルに存在しないブランドが記事に登場した場合、
> 必ず「ブランド調査プロセス」を実行し、結果をこのテーブルに追記すること。
> スキルは使うたびに進化し続ける。

### 登録済みブランド

| 企業/プロダクト | プライマリ | セカンダリ | 背景推奨 | アイコン形状 | SVGキャラ実装ヒント |
|---------------|----------|----------|---------|------------|-------------------|
| Anthropic/Claude | #da7756 (テラコッタ) | #F4F3EE (パンパス), #B1ADA1 (Cloudy) | クリーム/テラコッタ | スターバースト/ピンホイール（放射状4弁花） | `claudeSparkle()` — 4つの楕円ペタル + 中心円。顔を入れてキャラ化。実装例: `thumbnail-variants-v2.mjs` pattern2 |
| OpenAI/GPT/Codex | #10a37f (グリーン) | #1a1a1a, #ffffff | ダーク/グリーン | 六角形ロゴ（hexagonal aperture） | 6辺ポリゴン + 中央に開口部。グリーングロー効果。目を入れてキャラ化 |
| Google/Gemini | #4285F4 (ブルー) | #EA4335 (赤), #FBBC04 (黄), #34A853 (緑) | ホワイト/ブルー | Geminiスター（2つの交差する弧）/ Google 4色ドット | 4色グラデーションの星形。各ポイントに異なる色 |
| Microsoft/Copilot | #0078D4 (ブルー) | #50E6FF (シアン), #005A9E | ブルー/ダーク | 4分割ウィンドウ（田の字） | 4つの正方形を少し離して配置。各色微妙に変える |
| Cursor | #7C3AED (パープル) | #1a1a2e | ダーク/パープル | テキストカーソル（I-beam）+ コードブラケット | `<>` ブラケット + 点滅カーソル線。パープルグロー |
| Vercel/Next.js | #000000 | #ffffff | ダーク/ホワイト | 三角形（▲ Vercelロゴ） | 正三角形。白黒のコントラスト。シャープな印象 |
| Meta/LLaMA | #0668E1 (ブルー) | #1877F2 | ブルー系 | インフィニティマーク（∞） | 横8の字パス。グラデーションストローク |
| GitHub/Copilot | #24292e (ダークグレー) | #6e5494 (パープル), #f0f6fc | ダーク/パープル | Octocat（猫+タコ） | 丸い顔 + 触手風の脚 + 猫耳。目は大きく丸い |
| Apple/Xcode | #147EFB (ブルー) | #53D769 (グリーン), #FC3D39 (赤) | ブルー/ホワイト | ハンマー（Xcodeアイコン）/ Swiftロゴ（鳥） | Swiftの鳥形状をキャラ化。翼を広げたシルエット |

### 汎用カテゴリ（特定企業なし）

| カテゴリ | カラー | キャラクター | SVG実装ヒント |
|---------|--------|------------|--------------|
| 朝刊Digest | #3B82F6 ブルー | ニュースペーパー持ちロボット | LED目の四角ロボット + 新聞アイコン |
| 夕刊Digest | #F97316 オレンジ | サンセット背景のロボット | 暖色グラデーション + ロボット |
| ニュース | #6366F1 インディゴ | LEDロボット | v1のPattern Cスタイルのロボット |
| ナレッジ | #10b981 エメラルド | 本を読むロボット | ロボット + 開いた本のアイコン |
| 事例 | #f59e0b アンバー | グラフを見せるロボット | ロボット + 上昇チャート |
| プロダクト | #8B5CF6 バイオレット | プロダクトショーケースロボット | ロボット + 展示台 |

---

## ブランド調査プロセス（未登録ブランドの場合）

> サムネイル作成時に「ブランドアセットDB」に該当企業がない場合、**必ず**以下を実行する。

### Step 1: ブランド情報の収集
```
WebSearch: "{企業名} brand colors logo hex 2025 2026"
WebSearch: "{企業名} logo icon design identity"
WebSearch: "{プロダクト名} brand color palette hex"
```

### Step 2: 以下の情報を特定
- [ ] **プライマリカラー**: HEXコード
- [ ] **セカンダリカラー**: HEXコード（1-3色）
- [ ] **ロゴ/アイコン形状**: 具体的な形（例: 六角形、スター、動物等）
- [ ] **ロゴの特徴的ディテール**: 色の使い方、線の太さ、角丸具合
- [ ] **ブランドの雰囲気**: 温かい/クール/テック/アカデミック等
- [ ] **推奨背景**: ブランドカラーに合う背景色

### Step 3: SVGキャラクター設計
収集した情報をもとに、アイコン形状をキャラクター化する:
- ロゴの形状をベースにした「体」
- 丸い目と笑顔の「顔」を追加（親しみやすさ）
- 「手」をつけてサインボードや吹き出しを持たせる
- ブランドカラーで着色

### Step 4: スキルファイルへの記録（必須）
**調査結果を必ず「ブランドアセットDB」テーブルに追記する。**

```bash
# このスキルファイルを編集して新しい行を追加
Edit .claude/skills/thumbnail-generation.md
# → 「登録済みブランド」テーブルに新しい行を追記
```

記録フォーマット:
```
| {企業/プロダクト} | {プライマリ HEX} | {セカンダリ HEX} | {背景推奨} | {アイコン形状の説明} | {SVGキャラ実装のヒント} |
```

### Step 5: 実装例の保存（推奨）
特に良くできたキャラクターSVGは、`scripts/thumbnail-variants-v2.mjs` 等に
関数として保存しておくと、次回以降再利用できる。

---

## デザインテンプレート構造

```
┌──────────────────────────────────┐
│ [NEWSバッジ]                     │
│                                  │
│ 英語タイトル部分     [キャラクター] │
│ (大きなセリフ体)     [+ 装飾]     │
│ 日本語サブタイトル   [+ 吹出し等]  │
│ (ブランドカラー)                  │
│ ───                              │
│ [AI SOLO BUILDER]                │
└──────────────────────────────────┘
```

**テキスト配置**:
- カテゴリバッジ: 左上 `(x:60, y:80)` — 丸角の塗りつぶしバッジ
- タイトル英語部分: 大きなセリフ体 `font-size:56-58` font-weight:900
- タイトル日本語部分: sans-serif `font-size:40-42` font-weight:700、ブランドカラーで着色
- ディバイダー: 小さなアクセントバー
- ブランドラベル: 丸角ピル内に「AI SOLO BUILDER」

**キャラクター配置**:
- 右側 `(x:850-950, y:240-280)` に配置
- サイズ: 高さ約300px
- 吹き出しやサインボードで記事のキーワードを表示
- ブランドのアイコン形状をベースにしたマスコット

**キャラクター化の原則**:
1. ロゴ/アイコンの形状を「体」として使う
2. 丸い目（白目+黒目+ハイライト）と笑顔を追加
3. 小さな手（丸い形）を左右に追加
4. ブランドカラーで着色し、顔部分はクリーム/白で対比
5. 周囲にミニスパークルや装飾を散りばめる

## 技術仕様

### ツール
- **Sharp** (0.34.5) — SVG→PNG変換・合成
- **OpenAI DALL-E 3** (オプション) — AI背景生成（$0.04/枚）

### SVGでの注意事項
- **絵文字禁止**: Sharp/PangoがSVG内の絵文字をレンダリングできない（クラッシュする）
- **フォント**: `font-family="serif"` と `font-family="sans-serif"` のみ使用
- **XML特殊文字**: `escapeXml()` で `& < > " '` をエスケープ必須
- **出力サイズ**: 1200x630px PNG

### ファイル構成

| ファイル | 役割 |
|---------|------|
| `scripts/generate-thumbnail.mjs` | メインCLIスクリプト |
| `scripts/thumbnail-variants-v2.mjs` | Claude Elegant デザインの実装例（パターン参考） |
| `public/thumbnails/{slug}.png` | 生成された画像ファイル |
| `src/app/news/[slug]/opengraph-image.tsx` | OGP動的画像（フォールバック） |

### CLIコマンド

```bash
# 単一記事（フォールバック背景）
npm run generate:thumbnail -- --slug "slug-name" --no-ai

# 単一記事（DALL-E背景）
npm run generate:thumbnail -- --slug "slug-name"

# 未生成記事を一括
npm run generate:thumbnails:missing

# 全記事
npm run generate:thumbnails:all

# 対象確認のみ
npm run generate:thumbnail -- --missing --dry-run
```

### DB-only記事の対応
- `content/news/` にローカルファイルがない記事はSupabaseから取得
- サムネイル生成後、frontmatter更新はスキップ（ファイルがないため）
- DBの `hero_image_url` を手動またはスクリプトで `/thumbnails/{slug}.png` に更新する

## ワークフロー

### 新規記事のサムネイル作成手順

1. **関連企業の特定**: 記事のタイトル・`relatedProducts`・本文から主要企業を特定
2. **ブランドアセット確認**: 上記「ブランドアセットDB」を参照
   - **登録済み** → カラー・アイコン形状・SVGヒントをそのまま使う
   - **未登録** → 「ブランド調査プロセス」を実行し、結果をDBに追記
3. **最高の1案を設計・生成**: ブランドのアイコンをキャラクター化し、最も記事内容に合ったSVGを1つ設計・生成する（複数案は作らない）
4. **保存**: `public/thumbnails/{slug}.png` に保存
5. **DB更新**: `hero_image_url` を `/thumbnails/{slug}.png` に更新
6. **スキル更新**: 新たに調査したブランド情報があれば、このスキルファイルのテーブルに追記

## 参照ファイル

| ファイル | 内容 |
|---------|------|
| `scripts/generate-thumbnail.mjs` | メインCLIスクリプト（フォールバック+DALL-E） |
| `scripts/thumbnail-variants-v2.mjs` | Claude Elegant デザインの実装例 |
| `src/lib/types.ts` L34-41 | CATEGORIESマッピング（カラー定義） |
| `src/app/news/[slug]/opengraph-image.tsx` | OGP画像生成 |
| `docs/business/BRAND-IDENTITY.md` | サイト全体のブランドカラー |
